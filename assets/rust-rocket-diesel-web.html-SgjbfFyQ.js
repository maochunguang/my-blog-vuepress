import{_ as p}from"./plugin-vue_export-helper-x3n3nnut.js";import{r as o,o as c,c as l,a as n,f as s,b as e,d as i,e as t}from"./app-oknJlhnq.js";const u={},r=n("h1",{id:"rocket-diesel-mysqlé¡¹ç›®æ•´åˆ",tabindex:"-1"},[n("a",{class:"header-anchor",href:"#rocket-diesel-mysqlé¡¹ç›®æ•´åˆ"},[n("span",null,"rocket+diesel+mysqlé¡¹ç›®æ•´åˆ")])],-1),d={href:"https://github.com/maochunguang/rust-blog",target:"_blank",rel:"noopener noreferrer"},k=n("p",null,[s("å¼€å‘ç¯å¢ƒï¼šwin11+wsl2ï¼Œrustç‰ˆæœ¬"),n("code",null,"1.76.0-nightly"),s("ï¼Œrocketç‰ˆæœ¬"),n("code",null,"0.5.0"),s("ï¼Œdieselç‰ˆæœ¬ "),n("code",null,"2.1.0"),s("ï¼Œmysqlç‰ˆæœ¬"),n("code",null,"8.0"),s("ã€‚")],-1),m=t(`<h2 id="ç¬¬ä¸€æ­¥-å®‰è£…rustç¯å¢ƒ" tabindex="-1"><a class="header-anchor" href="#ç¬¬ä¸€æ­¥-å®‰è£…rustç¯å¢ƒ"><span>ç¬¬ä¸€æ­¥ï¼Œå®‰è£…rustç¯å¢ƒ</span></a></h2><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">curl</span> <span class="token parameter variable">--proto</span> <span class="token string">&#39;=https&#39;</span> <span class="token parameter variable">--tlsv1.2</span> <span class="token parameter variable">-sSf</span> https://sh.rustup.rs <span class="token operator">|</span> <span class="token function">sh</span>
<span class="token comment">## è®¾ç½®rustä¸ºnightlyæˆ–è€…devéƒ½è¡Œï¼Œä¸è¦stableã€‚</span>
rustup default nightly
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ğŸ’¡è¸©ä¸ªå°å‘" tabindex="-1"><a class="header-anchor" href="#ğŸ’¡è¸©ä¸ªå°å‘"><span>ğŸ’¡è¸©ä¸ªå°å‘</span></a></h4><p>ç¬¬ä¸€ä¸ªå‘åœ¨è¿™é‡Œï¼Œå¦‚æœä¸æŠŠrustè®¾ç½®ä¸ºdevæˆ–è€…nightlyåé¢å®‰è£…dieselä¼šæŠ¥é”™ï¼Œåˆ«é—®ä¸ºå•¥æŠ¥é”™ï¼Œé—®å°±æ˜¯æ¡†æ¶å°±è¿™æ ·ã€‚</p><h2 id="ç¬¬äºŒæ­¥-å®‰è£…diesel-cli" tabindex="-1"><a class="header-anchor" href="#ç¬¬äºŒæ­¥-å®‰è£…diesel-cli"><span>ç¬¬äºŒæ­¥ï¼Œå®‰è£…diesel_cli</span></a></h2><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">cargo</span> <span class="token function">install</span> diesel_cli --no-default-features <span class="token parameter variable">--features</span> mysql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h4 id="ğŸ’¡è¸©ä¸ªå°å‘-1" tabindex="-1"><a class="header-anchor" href="#ğŸ’¡è¸©ä¸ªå°å‘-1"><span>ğŸ’¡è¸©ä¸ªå°å‘</span></a></h4><p>å¦‚æœä¸å‡ºæ„å¤–ï¼Œè¿™é‡Œä¸€å®šä¼šæŠ¥é”™ï¼Œå› ä¸ºè¿™ä¸ªåº“åº•å±‚ä¾èµ–<code>mysqlclient</code>ï¼Œæ›´ä»¤äººæ„å¤–çš„æ˜¯è¿™ä¸ªåº“æ˜¯<code>python</code>çš„ï¼Œæ‰€ä»¥ä½ å¿…é¡»è¦åœ¨wsl2é‡Œå®‰è£…å¥½pythonç¯å¢ƒï¼Œå»ºè®®pythonç‰ˆæœ¬3.10å·¦å³ã€‚</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>note: ld: library not found for -lmysqlclient
clang: error: linker command failed with exit code 1 (use -v to see invocation)
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>ä¸‹é¢å…ˆå®‰è£…<code>mysqlclient</code>ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment">## å®‰è£…ç¯å¢ƒä¾èµ–</span>
<span class="token function">sudo</span> <span class="token function">apt</span> <span class="token function">install</span> default-libmysqlclient-dev build-essential
pip <span class="token function">install</span> mysqlclient
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç¬¬ä¸‰æ­¥-åˆå§‹åŒ–å·¥ç¨‹" tabindex="-1"><a class="header-anchor" href="#ç¬¬ä¸‰æ­¥-åˆå§‹åŒ–å·¥ç¨‹"><span>ç¬¬ä¸‰æ­¥ï¼Œåˆå§‹åŒ–å·¥ç¨‹</span></a></h2><h4 id="åˆå§‹åŒ–é¡¹ç›®" tabindex="-1"><a class="header-anchor" href="#åˆå§‹åŒ–é¡¹ç›®"><span>åˆå§‹åŒ–é¡¹ç›®</span></a></h4><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">cargo</span> new <span class="token parameter variable">--lib</span> rust-blog

<span class="token builtin class-name">cd</span> rust-blog
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¿®æ”¹cargo-tomlçš„ä¾èµ–" tabindex="-1"><a class="header-anchor" href="#ä¿®æ”¹cargo-tomlçš„ä¾èµ–"><span>ä¿®æ”¹Cargo.tomlçš„ä¾èµ–ï¼š</span></a></h4><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>[dependencies]
rocket = {version = &quot;0.5.0&quot;, features =[&quot;json&quot;]}
diesel = { version = &quot;2.1.0&quot;, features = [&quot;mysql&quot;, &quot;r2d2&quot;, &quot;chrono&quot;] }
r2d2 = &quot;0.8.10&quot;
r2d2_mysql = &quot;23.0.0&quot;
rocket_sync_db_pools = { version = &quot;0.1.0&quot;, features = [&quot;diesel&quot;, &quot;diesel_mysql_pool&quot;] }
serde = { version = &quot;1.0&quot;, features = [&quot;derive&quot;] }
# Powerful date and time functionality
chrono = { version = &quot;0.4.15&quot;, features = [&quot;serde&quot;] }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="åˆ›å»ºæ•°æ®åº“é…ç½®" tabindex="-1"><a class="header-anchor" href="#åˆ›å»ºæ•°æ®åº“é…ç½®"><span>åˆ›å»ºæ•°æ®åº“é…ç½®</span></a></h4><p>åˆ›å»º<code>.env</code>æ–‡ä»¶, é‡Œé¢æ˜¯ä½ çš„mysqlæ•°æ®åº“åœ°å€ï¼Œ</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>DATABASE_URL=mysql://devbox:mypassword@localhost/my_blog
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>åˆ›å»º<code>diesel.toml</code>é…ç½®æ–‡ä»¶</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code># For documentation on how to configure this file,
# see https://diesel.rs/guides/configuring-diesel-cli

[print_schema]
file = &quot;src/schema.rs&quot;
custom_type_derives = [&quot;diesel::query_builder::QueryId&quot;]

[migrations_directory]
dir = &quot;migrations&quot;

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="æ‰§è¡Œdieselå‘½ä»¤-ç”Ÿæˆä»£ç " tabindex="-1"><a class="header-anchor" href="#æ‰§è¡Œdieselå‘½ä»¤-ç”Ÿæˆä»£ç "><span>æ‰§è¡Œdieselå‘½ä»¤ï¼Œç”Ÿæˆä»£ç </span></a></h4><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>diesel migration generate create_users
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä¿®æ”¹mirationsç›®å½•ä¸‹çš„up.sqlå’Œdown.sqlã€‚</p><div class="language-sql line-numbers-mode" data-ext="sql" data-title="sql"><pre class="language-sql"><code><span class="token comment">---- up.sql start-------</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> blog_users <span class="token punctuation">(</span>
    id <span class="token keyword">BIGINT</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;ç”¨æˆ·å”¯ä¸€æ ‡è¯†&#39;</span><span class="token punctuation">,</span>
    username <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;ç”¨æˆ·å&#39;</span><span class="token punctuation">,</span>
    password_hash <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;å­˜å‚¨åŠ å¯†åçš„å¯†ç &#39;</span><span class="token punctuation">,</span>
    email <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;ç”¨æˆ·ç”µå­é‚®ä»¶åœ°å€&#39;</span><span class="token punctuation">,</span>
    create_time <span class="token keyword">TIMESTAMP</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CURRENT_TIMESTAMP</span> <span class="token keyword">COMMENT</span> <span class="token string">&#39;è®°å½•åˆ›å»ºæ—¶é—´&#39;</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span><span class="token operator">=</span><span class="token keyword">InnoDB</span> <span class="token keyword">DEFAULT</span> <span class="token keyword">CHARSET</span><span class="token operator">=</span>utf8mb4 <span class="token keyword">COMMENT</span><span class="token operator">=</span><span class="token string">&#39;å­˜å‚¨ç”¨æˆ·ä¿¡æ¯&#39;</span><span class="token punctuation">;</span>
<span class="token comment">---- up.sql end-------</span>

<span class="token comment">---- down.sql start-------</span>
<span class="token keyword">DROP</span> <span class="token keyword">TABLE</span> blog_users<span class="token punctuation">;</span>
<span class="token comment">---- up.sql end-------</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œ<code>diesel migration run</code>ç”Ÿæˆschema.rsæ–‡ä»¶ã€‚<br> æ‰§è¡Œ<code>diesel migration redo</code>æµ‹è¯•down.sqlæ˜¯å¦ç”Ÿæ•ˆã€‚</p>`,26),v={id:"åˆ›å»ºmain-rs-è·‘ä¸€ä¸‹hello-world",tabindex:"-1"},b={class:"header-anchor",href:"#åˆ›å»ºmain-rs-è·‘ä¸€ä¸‹hello-world"},g={href:"http://xn--main-pj9fv59d.rs",target:"_blank",rel:"noopener noreferrer"},h=t(`<div class="language-rust line-numbers-mode" data-ext="rs" data-title="rs"><pre class="language-rust"><code><span class="token comment">// main.rs</span>
<span class="token attribute attr-name">#[macro_use]</span> <span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">rocket</span><span class="token punctuation">;</span>

<span class="token attribute attr-name">#[get(<span class="token string">&quot;/&quot;</span>)]</span>
<span class="token keyword">fn</span> <span class="token function-definition function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;static</span> <span class="token keyword">str</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;Hello, world!&quot;</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[launch]</span>
<span class="token keyword">fn</span> <span class="token function-definition function">rocket</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> _ <span class="token punctuation">{</span>
    <span class="token namespace">rocket<span class="token punctuation">::</span></span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token macro property">routes!</span><span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œ<code>cargo build</code>ï¼Œ<code>cargo run</code>ï¼Œè®¿é—®<code>localhost:8000</code>ï¼Œæ£€éªŒä¸€ä¸‹é¡¹ç›®ã€‚</p><h2 id="ç¬¬å››æ­¥ã€åˆ›å»ºé¡¹ç›®ç»“æ„" tabindex="-1"><a class="header-anchor" href="#ç¬¬å››æ­¥ã€åˆ›å»ºé¡¹ç›®ç»“æ„"><span>ç¬¬å››æ­¥ã€åˆ›å»ºé¡¹ç›®ç»“æ„ï¼Œ</span></a></h2><p>æ•´ä½“çš„é¡¹ç›®ç»“æ„å¦‚ä¸‹ï¼Œå‰æœŸä¸ºäº†é¡¹ç›®å…¥æ‰‹éš¾åº¦ä½ï¼Œæ‰€æœ‰çš„æ¨¡å—éƒ½åœ¨srcæ ¹ç›®å½•ï¼Œè¿™æ ·æ¯”è¾ƒæ–¹ä¾¿ç®€å•ã€‚è€Œä¸”æ‰€æœ‰çš„modå®šä¹‰ä¹Ÿéƒ½åœ¨main.rsé‡Œï¼Œè¿™æ ·å„ä¸ªæ–‡ä»¶å¼•ç”¨ä¹Ÿç®€å•ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token builtin class-name">.</span>
â”œâ”€â”€ Cargo.toml
â”œâ”€â”€ README.md
â”œâ”€â”€ Rocket.toml         <span class="token comment">### rocketæ¡†æ¶é…ç½®</span>
â”œâ”€â”€ diesel.toml         <span class="token comment">### æ•°æ®åº“é“¾æ¥é…ç½®</span>
â””â”€â”€ src
    â”œâ”€â”€ db_conn.rs      <span class="token comment">### æ•°æ®åº“é“¾æ¥é…ç½®</span>
    â”œâ”€â”€ main.rs         <span class="token comment">### æœåŠ¡å¯åŠ¨æ–‡ä»¶</span>
    â”œâ”€â”€ models.rs       <span class="token comment">### å…¨å±€modelçš„å®šä¹‰</span>
    â”œâ”€â”€ routes.rs       <span class="token comment">### è·¯ç”±æ–‡ä»¶</span>
    â”œâ”€â”€ schema.rs       <span class="token comment">### dieselç”Ÿæˆçš„æ–‡ä»¶</span>
    â””â”€â”€ user_lib.rs     <span class="token comment">### serviceæ ¸å¿ƒé€»è¾‘</span>
â”œâ”€â”€ migrations
â”‚   â””â”€â”€ <span class="token number">2023</span>-11-20-123055_create_users
â”‚       â”œâ”€â”€ down.sql
â”‚       â””â”€â”€ up.sql
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç¬¬äº”æ­¥-åˆ›å»ºæ•°æ®åº“è¿æ¥" tabindex="-1"><a class="header-anchor" href="#ç¬¬äº”æ­¥-åˆ›å»ºæ•°æ®åº“è¿æ¥"><span>ç¬¬äº”æ­¥ï¼Œåˆ›å»ºæ•°æ®åº“è¿æ¥</span></a></h2><h4 id="ä¿®æ”¹db-conn-rs" tabindex="-1"><a class="header-anchor" href="#ä¿®æ”¹db-conn-rs"><span>ä¿®æ”¹<code>db_conn.rs</code>ï¼Œ</span></a></h4><div class="language-rust line-numbers-mode" data-ext="rs" data-title="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">rocket_sync_db_pools<span class="token punctuation">::</span></span><span class="token punctuation">{</span>database<span class="token punctuation">,</span> diesel<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token comment">// æ•°æ®åº“è¿æ¥</span>
<span class="token attribute attr-name">#[database(<span class="token string">&quot;mysql_db&quot;</span>)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">DbConn</span><span class="token punctuation">(</span><span class="token namespace">diesel<span class="token punctuation">::</span></span><span class="token class-name">MysqlConnection</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ğŸ’¡è¸©ä¸ªå°å‘-2" tabindex="-1"><a class="header-anchor" href="#ğŸ’¡è¸©ä¸ªå°å‘-2"><span>ğŸ’¡è¸©ä¸ªå°å‘</span></a></h4><p>è¿™é‡Œæœ‰ä¸ªå‘ï¼Œåˆšå¼€å§‹<code>diesel</code>å°±æ˜¯æ— æ³•å¼•å…¥è¿›æ¥ï¼Œæœ€ååœ¨æºç é‡Œæ‰¾åˆ°äº†ç­”æ¡ˆã€‚ä¹Ÿå°±æ˜¯ä¾èµ–é‡Œ<code>feature</code>å¿…é¡»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªä¹‹ä¸€ï¼Œæ‰ä¼šæœ‰<code>diesel</code></p><div class="language-rust line-numbers-mode" data-ext="rs" data-title="rs"><pre class="language-rust"><code><span class="token attribute attr-name">#[cfg(any(
    feature = <span class="token string">&quot;diesel_sqlite_pool&quot;</span>,
    feature = <span class="token string">&quot;diesel_postgres_pool&quot;</span>,
    feature = <span class="token string">&quot;diesel_mysql_pool&quot;</span>
))]</span>
<span class="token keyword">pub</span> <span class="token keyword">use</span> diesel<span class="token punctuation">;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,11),y={id:"ç„¶åä¿®æ”¹main-rs-æŠŠæ•°æ®åº“ç›¸å…³åŠ è¿›å»",tabindex:"-1"},f={class:"header-anchor",href:"#ç„¶åä¿®æ”¹main-rs-æŠŠæ•°æ®åº“ç›¸å…³åŠ è¿›å»"},_={href:"http://xn--main-486fn2tbv7aobu.rs",target:"_blank",rel:"noopener noreferrer"},w=t(`<div class="language-rust line-numbers-mode" data-ext="rs" data-title="rs"><pre class="language-rust"><code><span class="token keyword">mod</span> <span class="token module-declaration namespace">db_conn</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">db_conn<span class="token punctuation">::</span></span><span class="token class-name">DbConn</span><span class="token punctuation">;</span>

<span class="token keyword">fn</span> <span class="token function-definition function">rocket</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> _ <span class="token punctuation">{</span>
    <span class="token namespace">rocket<span class="token punctuation">::</span></span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span><span class="token class-name">DbConn</span><span class="token punctuation">::</span><span class="token function">fairing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token function">get_routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç¬¬å…­æ­¥-ä¿®æ”¹modelsæ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ç¬¬å…­æ­¥-ä¿®æ”¹modelsæ–‡ä»¶"><span>ç¬¬å…­æ­¥ï¼Œä¿®æ”¹modelsæ–‡ä»¶</span></a></h2><p>è¿™ä¸€æ­¥ä¼šæŠŠcrudéœ€è¦çš„å¯¹è±¡åˆ›å»ºå¥½ã€‚</p><div class="language-rust line-numbers-mode" data-ext="rs" data-title="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">serde<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">Serialize</span><span class="token punctuation">,</span> <span class="token class-name">Deserialize</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>schema<span class="token punctuation">::</span></span>blog_users<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">diesel<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

<span class="token comment">// å¯¹åº”äº blog_users è¡¨çš„ Rust ç»“æ„ä½“</span>
<span class="token attribute attr-name">#[derive(Serialize, Deserialize, Queryable, Identifiable, AsChangeset, Clone)]</span>
<span class="token attribute attr-name">#[diesel(table_name = blog_users)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">BlogUser</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> id<span class="token punctuation">:</span> <span class="token keyword">i64</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> username<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> password_hash<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> email<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> create_time<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token namespace">chrono<span class="token punctuation">::</span></span><span class="token class-name">NaiveDateTime</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token comment">// ç”¨äºåˆ›å»ºæ–°ç”¨æˆ·çš„ç»“æ„ä½“ï¼Œä¸åŒ…å« id å’Œ create_time å­—æ®µ</span>
<span class="token attribute attr-name">#[derive(Serialize, Deserialize, Insertable, Clone)]</span>
<span class="token attribute attr-name">#[diesel(table_name = blog_users)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">NewBlogUser</span> <span class="token punctuation">{</span>
    <span class="token keyword">pub</span> username<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> password_hash<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> email<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç¬¬ä¸ƒæ­¥-ä¿®æ”¹use-libæ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ç¬¬ä¸ƒæ­¥-ä¿®æ”¹use-libæ–‡ä»¶"><span>ç¬¬ä¸ƒæ­¥ï¼Œä¿®æ”¹use_libæ–‡ä»¶</span></a></h2><p>user_libå¯ä»¥çœ‹æˆæ˜¯serviceæ–‡ä»¶ï¼Œcrudæ ¸å¿ƒé€»è¾‘éƒ½åœ¨è¿™é‡Œã€‚</p><div class="language-rust line-numbers-mode" data-ext="rs" data-title="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">diesel<span class="token punctuation">::</span>prelude<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>models<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">BlogUser</span><span class="token punctuation">,</span> <span class="token class-name">NewBlogUser</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>db_conn<span class="token punctuation">::</span></span><span class="token class-name">DbConn</span><span class="token punctuation">;</span>

<span class="token keyword">pub</span> <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">create_user</span><span class="token punctuation">(</span>conn<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">DbConn</span><span class="token punctuation">,</span> new_user<span class="token punctuation">:</span> <span class="token class-name">NewBlogUser</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">QueryResult</span><span class="token operator">&lt;</span><span class="token keyword">usize</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>schema<span class="token punctuation">::</span>blog_users<span class="token punctuation">::</span>dsl<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> new_user_clone <span class="token operator">=</span> new_user<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å…‹éš† new_user</span>
    conn<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>c<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
        <span class="token namespace">diesel<span class="token punctuation">::</span></span><span class="token function">insert_into</span><span class="token punctuation">(</span>blog_users<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">values</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>new_user_clone<span class="token punctuation">)</span> <span class="token comment">// ä½¿ç”¨å…‹éš†</span>
            <span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span>
<span class="token punctuation">}</span>

<span class="token keyword">pub</span> <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">get_user</span><span class="token punctuation">(</span>conn<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">DbConn</span><span class="token punctuation">,</span> user_id<span class="token punctuation">:</span> <span class="token keyword">i64</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">QueryResult</span><span class="token operator">&lt;</span><span class="token class-name">BlogUser</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>schema<span class="token punctuation">::</span>blog_users<span class="token punctuation">::</span>dsl<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

    conn<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>c<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
        blog_users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>user_id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">first</span><span class="token punctuation">::</span><span class="token operator">&lt;</span><span class="token class-name">BlogUser</span><span class="token operator">&gt;</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span>
<span class="token punctuation">}</span>

<span class="token keyword">pub</span> <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">update_user</span><span class="token punctuation">(</span>conn<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">DbConn</span><span class="token punctuation">,</span> user_id<span class="token punctuation">:</span> <span class="token keyword">i64</span><span class="token punctuation">,</span> user_data<span class="token punctuation">:</span> <span class="token class-name">BlogUser</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">QueryResult</span><span class="token operator">&lt;</span><span class="token keyword">usize</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>schema<span class="token punctuation">::</span>blog_users<span class="token punctuation">::</span>dsl<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> new_user_clone <span class="token operator">=</span> user_data<span class="token punctuation">.</span><span class="token function">clone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// å…‹éš† new_user</span>

    conn<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>c<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
        <span class="token namespace">diesel<span class="token punctuation">::</span></span><span class="token function">update</span><span class="token punctuation">(</span>blog_users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>user_id<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>new_user_clone<span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span>
<span class="token punctuation">}</span>

<span class="token keyword">pub</span> <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">delete_user</span><span class="token punctuation">(</span>conn<span class="token punctuation">:</span> <span class="token operator">&amp;</span><span class="token class-name">DbConn</span><span class="token punctuation">,</span> user_id<span class="token punctuation">:</span> <span class="token keyword">i64</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">QueryResult</span><span class="token operator">&lt;</span><span class="token keyword">usize</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>schema<span class="token punctuation">::</span>blog_users<span class="token punctuation">::</span>dsl<span class="token punctuation">::</span></span><span class="token operator">*</span><span class="token punctuation">;</span>

    conn<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token keyword">move</span> <span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>c<span class="token closure-punctuation punctuation">|</span></span> <span class="token punctuation">{</span>
        <span class="token namespace">diesel<span class="token punctuation">::</span></span><span class="token function">delete</span><span class="token punctuation">(</span>blog_users<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span>user_id<span class="token punctuation">)</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">execute</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ğŸ’¡è¸©ä¸ªå°å‘-3" tabindex="-1"><a class="header-anchor" href="#ğŸ’¡è¸©ä¸ªå°å‘-3"><span>ğŸ’¡è¸©ä¸ªå°å‘</span></a></h4><p>è¿™é‡Œæœ‰ä¸ªå‘ï¼Œå°±æ˜¯modelsçš„å¯¹è±¡ï¼Œå’Œschemaé‡Œçš„å¯¹è±¡å¿…é¡»å®Œå…¨ä¸€è‡´ã€‚å¦åˆ™åœ¨æŸ¥è¯¢çš„æ—¶å€™ä¼šå‡ºç°ç±»å‹è½¬æ¢é”™è¯¯ï¼Œè¿™é‡Œçš„åŸå› æ˜¯modelsçš„å¯¹è±¡ä¸ªåˆ«å­—æ®µæ²¡åŠ <code>Option</code>,å¦‚æœschemaé‡Œå­—æ®µæœ‰<code>Nullable</code>ï¼Œmodelsçš„å¯¹è±¡<code>Option</code>å¿…é¡»è¦åŠ ä¸Šã€‚</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code> the trait bound \`(BigInt, Text, Text, diesel::sql_types::Nullable&lt;Text&gt;, diesel::sql_types::Nullable&lt;diesel::sql_types::Timestamp&gt;): load_dsl::private::CompatibleType&lt;BlogUser, Mysql&gt;\` is not satisfied
    --&gt; src/user_lib.rs:19:52
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="ç¬¬å…«æ­¥-ä¿®æ”¹routesæ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#ç¬¬å…«æ­¥-ä¿®æ”¹routesæ–‡ä»¶"><span>ç¬¬å…«æ­¥ï¼Œä¿®æ”¹routesæ–‡ä»¶</span></a></h2><p>è¿™é‡Œä¸€æ¬¡æ€§æŠŠæ‰€æœ‰çš„routeéƒ½åˆ›å»ºå¥½ï¼Œç»Ÿä¸€æ”¾åˆ°routes.rsæ–‡ä»¶ï¼Œç„¶ååœ¨main.rsé‡Œå¼•ç”¨routesï¼Œè¿›è¡Œè·¯ç”±ã€‚</p><div class="language-rust line-numbers-mode" data-ext="rs" data-title="rs"><pre class="language-rust"><code><span class="token keyword">use</span> <span class="token namespace">rocket<span class="token punctuation">::</span>serde<span class="token punctuation">::</span>json<span class="token punctuation">::</span></span><span class="token class-name">Json</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">rocket<span class="token punctuation">::</span>http<span class="token punctuation">::</span></span><span class="token class-name">Status</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>db_conn<span class="token punctuation">::</span></span><span class="token class-name">DbConn</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>models<span class="token punctuation">::</span></span><span class="token punctuation">{</span><span class="token class-name">BlogUser</span><span class="token punctuation">,</span> <span class="token class-name">NewBlogUser</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token keyword">crate</span><span class="token module-declaration namespace"><span class="token punctuation">::</span>user_lib</span> <span class="token keyword">as</span> lib<span class="token punctuation">;</span>  <span class="token comment">// å¼•å…¥ lib.rs ä¸­çš„å‡½æ•°</span>

<span class="token attribute attr-name">#[get(<span class="token string">&quot;/&quot;</span>)]</span>
<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">index</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token operator">&amp;</span><span class="token lifetime-annotation symbol">&#39;static</span> <span class="token keyword">str</span> <span class="token punctuation">{</span>
    <span class="token string">&quot;Welcome to the Blog API&quot;</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[post(<span class="token string">&quot;/users/create&quot;</span>, data = <span class="token string">&quot;&lt;user&gt;&quot;</span>)]</span>
<span class="token keyword">pub</span> <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">create_user</span><span class="token punctuation">(</span>conn<span class="token punctuation">:</span> <span class="token class-name">DbConn</span><span class="token punctuation">,</span> user<span class="token punctuation">:</span> <span class="token class-name">Json</span><span class="token operator">&lt;</span><span class="token class-name">NewBlogUser</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Status</span> <span class="token punctuation">{</span>
    <span class="token keyword">match</span> <span class="token namespace">lib<span class="token punctuation">::</span></span><span class="token function">create_user</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>conn<span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">into_inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span> <span class="token punctuation">{</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token class-name">Status</span><span class="token punctuation">::</span><span class="token class-name">Created</span><span class="token punctuation">,</span>
        <span class="token class-name">Err</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token class-name">Status</span><span class="token punctuation">::</span><span class="token class-name">InternalServerError</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[get(<span class="token string">&quot;/users/&lt;id&gt;&quot;</span>)]</span>
<span class="token keyword">pub</span> <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">get_user</span><span class="token punctuation">(</span>conn<span class="token punctuation">:</span> <span class="token class-name">DbConn</span><span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token keyword">i64</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Result</span><span class="token operator">&lt;</span><span class="token class-name">Json</span><span class="token operator">&lt;</span><span class="token class-name">BlogUser</span><span class="token operator">&gt;</span><span class="token punctuation">,</span> <span class="token class-name">Status</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token namespace">lib<span class="token punctuation">::</span></span><span class="token function">get_user</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>conn<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span>
        <span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token class-name">Json</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">map_err</span><span class="token punctuation">(</span><span class="token closure-params"><span class="token closure-punctuation punctuation">|</span>_<span class="token closure-punctuation punctuation">|</span></span> <span class="token class-name">Status</span><span class="token punctuation">::</span><span class="token class-name">NotFound</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[put(<span class="token string">&quot;/users/&lt;id&gt;&quot;</span>, data = <span class="token string">&quot;&lt;user&gt;&quot;</span>)]</span>
<span class="token keyword">pub</span> <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">update_user</span><span class="token punctuation">(</span>conn<span class="token punctuation">:</span> <span class="token class-name">DbConn</span><span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token keyword">i64</span><span class="token punctuation">,</span> user<span class="token punctuation">:</span> <span class="token class-name">Json</span><span class="token operator">&lt;</span><span class="token class-name">BlogUser</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Status</span> <span class="token punctuation">{</span>
    <span class="token keyword">match</span> <span class="token namespace">lib<span class="token punctuation">::</span></span><span class="token function">update_user</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>conn<span class="token punctuation">,</span> id<span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">into_inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span> <span class="token punctuation">{</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token class-name">Status</span><span class="token punctuation">::</span><span class="token class-name">Ok</span><span class="token punctuation">,</span>
        <span class="token class-name">Err</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token class-name">Status</span><span class="token punctuation">::</span><span class="token class-name">NotFound</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token attribute attr-name">#[delete(<span class="token string">&quot;/users/&lt;id&gt;&quot;</span>)]</span>
<span class="token keyword">pub</span> <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">delete_user</span><span class="token punctuation">(</span>conn<span class="token punctuation">:</span> <span class="token class-name">DbConn</span><span class="token punctuation">,</span> id<span class="token punctuation">:</span> <span class="token keyword">i64</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Status</span> <span class="token punctuation">{</span>
    <span class="token keyword">match</span> <span class="token namespace">lib<span class="token punctuation">::</span></span><span class="token function">delete_user</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>conn<span class="token punctuation">,</span> id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span> <span class="token punctuation">{</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token class-name">Status</span><span class="token punctuation">::</span><span class="token class-name">Ok</span><span class="token punctuation">,</span>
        <span class="token class-name">Err</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token class-name">Status</span><span class="token punctuation">::</span><span class="token class-name">NotFound</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">pub</span> <span class="token keyword">fn</span> <span class="token function-definition function">get_routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Vec</span><span class="token operator">&lt;</span><span class="token namespace">rocket<span class="token punctuation">::</span></span><span class="token class-name">Route</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span>
    <span class="token macro property">routes!</span><span class="token punctuation">[</span>
        index<span class="token punctuation">,</span>
        create_user<span class="token punctuation">,</span>
        get_user<span class="token punctuation">,</span>
        update_user<span class="token punctuation">,</span>
        delete_user
    <span class="token punctuation">]</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ğŸ’¡è¸©ä¸ªå°å‘-4" tabindex="-1"><a class="header-anchor" href="#ğŸ’¡è¸©ä¸ªå°å‘-4"><span>ğŸ’¡è¸©ä¸ªå°å‘</span></a></h4><p><code>rocket</code>é…ç½®ä¾èµ–çš„æ—¶å€™ï¼Œä¹Ÿå¾—è®¾ç½®<code>feature</code>ï¼Œè¦ä¸ç„¶jsonæ‰¾ä¸åˆ°ã€‚</p><h2 id="ç¬¬ä¹æ­¥-ç»Ÿä¸€è¯·æ±‚è¿”å›ç»“æ„" tabindex="-1"><a class="header-anchor" href="#ç¬¬ä¹æ­¥-ç»Ÿä¸€è¯·æ±‚è¿”å›ç»“æ„"><span>ç¬¬ä¹æ­¥ï¼Œç»Ÿä¸€è¯·æ±‚è¿”å›ç»“æ„</span></a></h2><p>å…ˆå®šä¹‰é€šç”¨çš„è¿”å›ç»“æ„ï¼š</p><div class="language-json line-numbers-mode" data-ext="json" data-title="json"><pre class="language-json"><code><span class="token punctuation">{</span>
    <span class="token property">&quot;code&quot;</span><span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
    <span class="token property">&quot;message&quot;</span><span class="token operator">:</span> <span class="token string">&quot;ok&quot;</span><span class="token punctuation">,</span>
    <span class="token property">&quot;data&quot;</span><span class="token operator">:</span> <span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,18),q={id:"ä¿®æ”¹models-rs",tabindex:"-1"},x={class:"header-anchor",href:"#ä¿®æ”¹models-rs"},C={href:"http://xn--models-2g0js76l.rs",target:"_blank",rel:"noopener noreferrer"},E=t(`<p>å…ˆå®šä¹‰ä¸€ä¸ªé€šç”¨è¿”å›ç±»å‹<code>ResData</code></p><div class="language-rust line-numbers-mode" data-ext="rs" data-title="rs"><pre class="language-rust"><code><span class="token attribute attr-name">#[derive(Serialize, Deserialize, Clone)]</span>
<span class="token keyword">pub</span> <span class="token keyword">struct</span> <span class="token type-definition class-name">ResData</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">{</span>
    <span class="token keyword">pub</span> code<span class="token punctuation">:</span> <span class="token keyword">i32</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> message<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">,</span>
    <span class="token keyword">pub</span> data<span class="token punctuation">:</span> <span class="token class-name">Option</span><span class="token operator">&lt;</span><span class="token class-name">T</span><span class="token operator">&gt;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),N={id:"ä¿®æ”¹routes-rs",tabindex:"-1"},T={class:"header-anchor",href:"#ä¿®æ”¹routes-rs"},S={href:"http://xn--routes-2g0js76l.rs",target:"_blank",rel:"noopener noreferrer"},R=t(`<p>ä»¥create_userä¸ºä¾‹å­ï¼Œè¿›è¡Œè¿”å›å€¼çš„ä¿®æ”¹ã€‚å…¶ä»–æ¥å£çš„è¿”å›å€¼ä¸å…¶ç±»ä¼¼ã€‚</p><div class="language-rust line-numbers-mode" data-ext="rs" data-title="rs"><pre class="language-rust"><code><span class="token attribute attr-name">#[post(<span class="token string">&quot;/users/create&quot;</span>, data = <span class="token string">&quot;&lt;user&gt;&quot;</span>, format = <span class="token string">&quot;application/json&quot;</span>)]</span>
<span class="token keyword">pub</span> <span class="token keyword">async</span> <span class="token keyword">fn</span> <span class="token function-definition function">create_user</span><span class="token punctuation">(</span>conn<span class="token punctuation">:</span> <span class="token class-name">DbConn</span><span class="token punctuation">,</span> user<span class="token punctuation">:</span> <span class="token class-name">Json</span><span class="token operator">&lt;</span><span class="token class-name">NewBlogUser</span><span class="token operator">&gt;</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> <span class="token class-name">Json</span><span class="token operator">&lt;</span><span class="token class-name">ResData</span><span class="token operator">&lt;</span><span class="token class-name">String</span><span class="token operator">&gt;&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">match</span> <span class="token namespace">lib<span class="token punctuation">::</span></span><span class="token function">create_user</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>conn<span class="token punctuation">,</span> user<span class="token punctuation">.</span><span class="token function">into_inner</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token keyword">await</span> <span class="token punctuation">{</span>
        <span class="token class-name">Ok</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token class-name">Json</span><span class="token punctuation">(</span><span class="token class-name">ResData</span><span class="token punctuation">{</span>code<span class="token punctuation">:</span><span class="token number">0</span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">:</span> <span class="token class-name">None</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token class-name">Err</span><span class="token punctuation">(</span>_<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token class-name">Json</span><span class="token punctuation">(</span><span class="token class-name">ResData</span><span class="token punctuation">{</span>code<span class="token punctuation">:</span><span class="token number">500</span><span class="token punctuation">,</span> message<span class="token punctuation">:</span> <span class="token class-name">String</span><span class="token punctuation">::</span><span class="token function">from</span><span class="token punctuation">(</span><span class="token string">&quot;ok&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> data<span class="token punctuation">:</span> <span class="token class-name">None</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,2),D={id:"ç¬¬åæ­¥-ä¿®æ”¹æœ€ç»ˆçš„main-rs",tabindex:"-1"},O={class:"header-anchor",href:"#ç¬¬åæ­¥-ä¿®æ”¹æœ€ç»ˆçš„main-rs"},B={href:"http://xn--main-486fx14i9uc518bdtp.rs",target:"_blank",rel:"noopener noreferrer"},M=t(`<div class="language-rust line-numbers-mode" data-ext="rs" data-title="rs"><pre class="language-rust"><code><span class="token attribute attr-name">#[macro_use]</span> <span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">rocket</span><span class="token punctuation">;</span>
<span class="token keyword">extern</span> <span class="token keyword">crate</span> <span class="token module-declaration namespace">diesel</span><span class="token punctuation">;</span>
<span class="token keyword">mod</span> <span class="token module-declaration namespace">schema</span><span class="token punctuation">;</span>
<span class="token keyword">mod</span> <span class="token module-declaration namespace">models</span><span class="token punctuation">;</span>
<span class="token keyword">mod</span> <span class="token module-declaration namespace">routes</span><span class="token punctuation">;</span>
<span class="token keyword">mod</span> <span class="token module-declaration namespace">db_conn</span><span class="token punctuation">;</span>
<span class="token keyword">mod</span> <span class="token module-declaration namespace">user_lib</span><span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">routes<span class="token punctuation">::</span></span>get_routes<span class="token punctuation">;</span>
<span class="token keyword">use</span> <span class="token namespace">db_conn<span class="token punctuation">::</span></span><span class="token class-name">DbConn</span><span class="token punctuation">;</span>


<span class="token comment">// Rocket å¯åŠ¨å‡½æ•°</span>
<span class="token attribute attr-name">#[launch]</span>
<span class="token keyword">fn</span> <span class="token function-definition function">rocket</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">-&gt;</span> _ <span class="token punctuation">{</span>
    <span class="token namespace">rocket<span class="token punctuation">::</span></span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">attach</span><span class="token punctuation">(</span><span class="token class-name">DbConn</span><span class="token punctuation">::</span><span class="token function">fairing</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        <span class="token punctuation">.</span><span class="token function">mount</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token function">get_routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="ä¿®æ”¹é…ç½®-è°ƒè¯•ä»£ç " tabindex="-1"><a class="header-anchor" href="#ä¿®æ”¹é…ç½®-è°ƒè¯•ä»£ç "><span>ä¿®æ”¹é…ç½®ï¼Œè°ƒè¯•ä»£ç </span></a></h4><p>ä¿®æ”¹Rocket.tomæ–‡ä»¶</p><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>[global]
port = 9900

[global.databases]
mysql_db = { url = &quot;mysql://devbox:mypassword@localhost/my_blog&quot; }
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ‰§è¡Œ<code>cargo build</code>,<code>cargo run</code>çœ‹çœ‹æ˜¯å¦æœ‰ç¼–è¯‘é”™è¯¯ï¼Œæœ‰çš„è¯æ ¹æ®æŠ¥é”™è¿›è¡Œä¿®å¤ã€‚è®¿é—®localhost:9900/</p><h4 id="çœ‹çœ‹æˆæœ" tabindex="-1"><a class="header-anchor" href="#çœ‹çœ‹æˆæœ"><span>çœ‹çœ‹æˆæœ</span></a></h4><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>GET /users/1 text/html:
   &gt;&gt; Matched: (get_user) GET /users/&lt;id&gt;
   &gt;&gt; Outcome: Success(200 OK)
   &gt;&gt; Response succeeded.
GET / text/html:
   &gt;&gt; Matched: (index) GET /
   &gt;&gt; Outcome: Success(200 OK)
   &gt;&gt; Response succeeded.
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="todo" tabindex="-1"><a class="header-anchor" href="#todo"><span>todo</span></a></h2><ol><li>å•å…ƒæµ‹è¯•</li><li>ç™»å½•æ ¡éªŒ</li><li>æ—¥å¿—é…ç½®</li></ol><h2 id="å‚è€ƒæ–‡æ¡£" tabindex="-1"><a class="header-anchor" href="#å‚è€ƒæ–‡æ¡£"><span>å‚è€ƒæ–‡æ¡£</span></a></h2>`,10),A={href:"https://doc.rust-lang.org/book/",target:"_blank",rel:"noopener noreferrer"},U={href:"https://rocket.rs/v0.5/guide/getting-started/#hello-world",target:"_blank",rel:"noopener noreferrer"},I={href:"https://diesel.rs/guides/getting-started",target:"_blank",rel:"noopener noreferrer"},j={href:"https://docs.rs/diesel/2.1.0/diesel/index.html",target:"_blank",rel:"noopener noreferrer"},z={href:"https://pypi.org/project/mysqlclient/",target:"_blank",rel:"noopener noreferrer"};function L(J,V){const a=o("ExternalLinkIcon");return c(),l("div",null,[r,n("p",null,[s("æ•´ä¸ªé¡¹ç›®éƒ½æ˜¯ä»¥æœ€æ–°æ¡†æ¶ç‰ˆæœ¬è¿›è¡Œæ•´åˆï¼Œè¸©å‘æ— æ•°æ¬¡ï¼Œç½‘ä¸Šçš„æ•™ç¨‹éƒ½æ˜¯æ®‹ç¼ºä¸å…¨ï¼Œè¦ä¹ˆç‰ˆæœ¬è€æ—§ï¼Œè¿™ç‚¹å¿…é¡»åæ§½rustç”Ÿæ€æ˜¯å¾ˆçƒ‚ï¼Œæ¡†æ¶æ–‡æ¡£ä¹Ÿæ˜¯ç¨€çƒ‚ï¼Œå¾ˆå¤šé—®é¢˜éƒ½æ˜¯çœ‹æºç è§£å†³çš„ã€‚å¸Œæœ›æœ¬æ•™ç¨‹èƒ½ç»™åˆšå­¦ä¹ rustçš„æœ‹å‹ä¸€äº›å¸®åŠ©ã€‚å®Œæ•´ä»£ç åœ¨githubï¼Œ"),n("a",d,[s("rust-blog"),e(a)]),s("ã€‚")]),k,i(" more "),m,n("h4",v,[n("a",b,[n("span",null,[n("a",g,[s("åˆ›å»ºmain.rs"),e(a)]),s("ï¼Œè·‘ä¸€ä¸‹hello,world")])])]),h,n("h4",y,[n("a",f,[n("span",null,[n("a",_,[s("ç„¶åä¿®æ”¹main.rs"),e(a)]),s("ï¼ŒæŠŠæ•°æ®åº“ç›¸å…³åŠ è¿›å»")])])]),w,n("h4",q,[n("a",x,[n("span",null,[n("a",C,[s("ä¿®æ”¹models.rs"),e(a)])])])]),E,n("h4",N,[n("a",T,[n("span",null,[n("a",S,[s("ä¿®æ”¹routes.rs"),e(a)])])])]),R,n("h2",D,[n("a",O,[n("span",null,[s("ç¬¬åæ­¥ï¼Œ"),n("a",B,[s("ä¿®æ”¹æœ€ç»ˆçš„main.rs"),e(a)])])])]),M,n("ol",null,[n("li",null,[s("rustæ–‡æ¡£ï¼š"),n("a",A,[s("https://doc.rust-lang.org/book/"),e(a)])]),n("li",null,[s("rocketæ–‡æ¡£ï¼š "),n("ul",null,[n("li",null,[s("rocketå®˜æ–¹æ–‡æ¡£ï¼Œ"),n("a",U,[s("https://rocket.rs/v0.5/guide/getting-started/#hello-world"),e(a)])])])]),n("li",null,[s("dieselæ–‡æ¡£ï¼š "),n("ul",null,[n("li",null,[s("å®˜æ–¹å…¥é—¨æ–‡æ¡£ï¼Œ"),n("a",I,[s("https://diesel.rs/guides/getting-started"),e(a)])]),n("li",null,[s("rust-docæ–‡æ¡£ï¼Œ"),n("a",j,[s("https://docs.rs/diesel/2.1.0/diesel/index.html"),e(a)])])])]),n("li",null,[s("mysqlclientï¼š"),n("a",z,[s("https://pypi.org/project/mysqlclient/"),e(a)])])])])}const P=p(u,[["render",L],["__file","rust-rocket-diesel-web.html.vue"]]);export{P as default};
